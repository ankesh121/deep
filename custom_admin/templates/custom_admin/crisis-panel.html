{% extends 'base.html' %}
{% load watchful_url %}

{% block title %}
DEEP | Crisis Manager
{% endblock %}

{% block head %}

<link href="{% watchful_static_url 'css/crisis-panel.css' %}" type="text/css" rel="stylesheet">
<link rel="stylesheet" type="text/css" href="{% watchful_static_url 'css/selectize.css' %}"/>
<script type="text/javascript" src="{% watchful_static_url 'js/common/selectize.js' %}"></script>
<script type="text/javascript" src="{% watchful_static_url 'js/common/split.js' %}"></script>
<script type="text/javascript" src="{% watchful_static_url 'js/common/utils.js' %}"></script>
<script type="text/javascript" src="{% watchful_static_url 'js/custom-admin/crisis-panel.js' %}"></script>

<script>
    var crises = {
        {% for event in events %}
        "{{event.pk}}": {
            name: "{{event.name|escapejs}}", countries: [{% for country in event.countries.all %}"{{country.pk}}",{%endfor%}],
            start_date: "{{event.start_date|date:'Y-m-d'}}", end_date: "{{event.end_date|date:'Y-m-d'}}",
            status: "{{event.status}}",
            disaster_type: "{{event.disaster_type.pk}}",
            assigned_to: [
                {% for assigned_to in event.assignee.all %}"{{assigned_to.pk}}", {% endfor %}
            ],
            glide_number: "{{event.glide_number}}",
            spillover: {% if event.spill_over %}"{{event.spill_over.pk}}"{% else %}null{% endif %},
        },
        {% endfor %}
    };
</script>

{% endblock %}

{% block body %}
<header>
    <div class="container-fluid">
        <a href="{% url 'login' %}"><i class="fa fa-long-arrow-left"></i>Back to DEEP</a>
        <h1>Crisis Management Panel</h1>
    </div>
</header>
<main>
    <div class="container-fluid">
        <div class="row">
            <div class="col-md-3" >
                <div id="crisis-header">
                    <button id="add-new-crisis-btn" class="btn btn-primary" onclick="addNewCrisis()"><i class="fa fa-plus"></i>Add new crisis</button>
                    <h2>Crises</h2>
                    <input id="crisis-search" placeholder="Search crisis">
                    <i class="fa fa-search"></i>
                    <div id="crisis-status-radio">
                        <label class="active"><input name="crisis-status-radio" value="2" type="radio" checked>All</label>
                        <label><input name="crisis-status-radio" value="0" type="radio">Global Monitoring</label>
                        <label><input name="crisis-status-radio" value="1" type="radio">Active Crisis</label>
                    </div>
                </div>

                <div id="crisis-list">
                    {% for event in events %}
                    <div class="crisis {% if event.pk == selected_event %}active{% endif %}" data-crisis-status="{{ event.status }}" data-crisis-pk="{{ event.pk }}">{{event.name}}</div>
                    {% endfor %}
                </div>
            </div>
            <div class="col-md-7" >
                <div id="crisis-detail">
                    <form method="post" action="{% url 'custom_admin:crisis_panel' %}">
                    {%csrf_token%}
                    <h2>Add new crisis</h2>
                    <input type="hidden" name="crisis-pk" id="crisis-pk" value="new">
                    <div class="form-group">
                        <label>Name</label>
                        <input name="crisis-name" type="text" class="form-control" id="crisis-name" placeholder="Enter crisis name" required>
                    </div>
                    <div class="form-group">
                        <label> Crisis Status </label>
                        <div id="crisis-status">
                            <label><input class="crisis-status" name="crisis-status" value="0" type="radio">Global Monitoring</label>
                            <label><input class="crisis-status" name="crisis-status" value="1" type="radio" checked>Active Crisis</label>
                        </div>
                    </div>
                    <div class="form-group">
                        <label> Disaster Type </label>
                        <select name="disaster-type" class="form-control" id="disaster-type" placeholder="Select disaster type">
                            <option value="">Select disaster type</option>
                            {% for disaster_type in disaster_types %}
                            <option value="{{disaster_type.pk}}">{{disaster_type.name}}</option>
                            {% endfor %}
                        </select>
                    </div>
                    <div class="form-group">
                        <label> <a target="_blank" href="http://glidenumber.net/">Glide Number <span class="fa fa-external-link" style="margin-left: 8px;"></span></a> </label>
                        <input name="glide-number" type="text" class="form-control" id="glide-number" placeholder="Enter Glide Number">
                    </div>
                    <div class="form-group">
                        <label> Countries </label>
                        <select name="countries" class="form-control" id="countries" placeholder="Select countries" multiple>
                            <option value="">Select countries</option>
                            {% for country in countries %}
                            <option value="{{country.pk}}">{{country.name}}</option>
                            {% endfor %}
                        </select>
                    </div>
                    <div class="form-group">
                        <div class="row">
                            <div class="col-md-6">
                                <label id="padded-label">Start date:</label>
                                <div style="position: relative;">
                                    <input name="crisis-start-date" type="date" class="form-control" id="crisis-start-date" required>
                                </div>
                            </div>
                            <div class="col-md-6">
                                <label id="padded-label">End date:</label>
                                <div style="position: relative;">
                                    <input name="crisis-end-date" type="date" class="form-control" id="crisis-start-date">
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="form-group">
                        <label> Assigned To </label>
                        <select name="assigned-to" class="form-control" id="assigned-to" placeholder="Assigned to" multiple>
                            <option value="">Assigned to</option>
                            {% for u in users %}
                            {% if u.first_name != "" %}
                            <option value="{{u.pk}}">{{u.get_full_name}}</option>
                            {% endif %}
                            {% endfor %}
                        </select>
                    </div>
                    <div class="form-group">
                        <label> Spillover Effect </label>
                        <select name="spillover" class="form-control" id="spillover" placeholder="Spillover effect">
                            <option value="">Spillover</option>
                            {% for e in events %}
                            <option value="{{e.pk}}">{{e.name}}</option>
                            {% endfor %}
                        </select>
                    </div>
                    <div class = "form-group" id="action-buttons">
                        <button class='btn btn-danger' name="delete" id="delete-btn"onclick="return confirm('Are you sure you want to delete this crisis?');" hidden> <i class='fa fa-trash'></i>Delete Crisis</button>
                        <button class='btn btn-info' name="save"> <i class='fa fa-save'></i>Save Crisis</button>
                    </div>

                    </form>
                </div>
            </div>
        </div>

    </div>
</main>
{% endblock %}
