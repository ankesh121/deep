{% extends 'base.html' %}
{% load watchful_url %}

{% block title %}
DEEP | Project Details
{% endblock %}

{% block head %}

<link rel="stylesheet" type="text/css" href="{% watchful_static_url 'css/selectize.css' %}" />
<link rel="stylesheet" type="text/css" href="{% watchful_static_url 'css/project-details.css' %}" />
<script type="text/javascript" src="{% watchful_static_url 'js/common/selectize.js' %}"></script>
<script type="text/javascript" src="{% watchful_static_url 'js/common/utils.js' %}"></script>
<script type="text/javascript" src="{% watchful_static_url 'js/custom-admin/project-panel/project-details.js' %}"></script>
{# comment #}
<script>
var projects = {
    {% for event in events %}
    "{{event.pk}}": {
        name: "{{event.name|escapejs}}",
        countries: [{% for country in event.countries.all %}"{{country.pk}}",{%endfor%}],
        description: "{{event.description}}",
        start_date: "{{event.start_date|date:'Y-m-d'}}",
        end_date: "{{event.end_date|date:'Y-m-d'}}",
        status: "{{event.status}}",
        disaster_type: "{{event.disaster_type.pk}}",
        assigned_to: [
            {% for assigned_to in event.assignee.all %}"{{assigned_to.pk}}", {% endfor %}
        ],
        glide_number: "{{event.glide_number}}",
        spillover: {% if event.spill_over %}"{{event.spill_over.pk}}"{% else %}null{% endif %},
        usergroups: [{% for group in event.usergroup_set.all %}"{{group.pk}}", {% endfor %}],
        admins: [{% for admin in event.admins.all %}"{{admin.pk}}", {% endfor %}],
        members: [{% for member in event.members.all %}"{{member.pk}}", {% endfor %}],
        entry_template: {% if event.entry_template %}"{{ event.entry_template.pk }}"{% else %}null{% endif %},
        num_entries: {{ event.get_num_entries }}
    },
    {% endfor %}
};

var defaultGroupSelection = {% if selected_group %}["{{selected_group}}"]{% else %}""{% endif %};
var defaultAdminSelection = ["{{request.user.pk}}"];
let myPk = '{{request.user.pk}}';
</script>
{# comment #}

{% endblock %}

{% block body %}
<nav>
    <header>
        <a title="DEEP" href="{% url 'login' %}"><img class="deep-logo" src="{% watchful_static_url 'img/deep-logo-sm-white.png' %}"></a>
        <h1>Project Management Panel</h1>
    </header>
</nav>
<aside>
    <header>
        <div>
            <h2>Related projects</h2>
            <a><i class="fa fa-plus"></i>Add new</a>
        </div>
        <div>
            <i class="fa fa-search"></i>
            <input type="search" name="project-search" placeholder="Search projects">
        </div>
    </header>
    <div id="project-list">
        {% for event in events %}
        <div class="project {% if event.pk == selected_event %}active{% endif %}">
            <header>
                <div class="name">{{ event.name }}</div>
                <button><i class="fa fa-chevron-down"></i></button>
                <div class="dates">
                    <label>Created: <date>{% if event.created_at %}{{ event.created_at | date:'d N Y' }}{% else %}N/A{% endif %}</date></label>
                    <label>Last modified: <date>{{ event.modified_at | date:'d N Y' }}</date></label>
                </div>
            </header>
            <div class="details" hidden>
                <div class="project-description">{{ event.description }}</div>
                <div class="action-buttons">
                    <button>Join project</button>
                </div>
            </div>
        </div>
        {% endfor %}
    </div>
</aside>
<main>
    <header>
        <a class="active">1. Project details</a>
        <a href="{% url 'custom_admin:geo_area' %}">2. Geo area</a>
        <a href="{% url 'custom_admin:analysis_framework' %}">3. Analysis framework</a>
    </header>
    <div id="project-detail">
        <form method="post" action="{% url 'custom_admin:project_panel' %}">
            {%csrf_token%}
            <div class="action-buttons">
                <button class='btn-danger' name="delete" id="delete-btn"onclick="return confirm('Are you sure you want to delete this project?');" hidden> <i class='fa fa-trash'></i>Delete project</button>
                <button class='btn-info' id="save-btn" name="save"> <i class='fa fa-save'></i>Save project</button>
                <button class='btn-info' id="save-and-proceed-btn" name="save-and-proceed"> <i class='fa fa-arrow-right'></i>Save &amp; proceed</button>
            </div>
            <div class="input-group-list">
                <input type="hidden" name="project-pk" id="project-pk" value="new">
                <div class="input-group">
                    <label>Name</label>
                    <input name="project-name" type="text" id="project-name" placeholder="Enter project name" required>
                </div>
                <div class="input-groups">
                    <div class="input-group">
                        <label id="padded-label">Start date:</label>
                        <input name="project-start-date" type="date" id="project-start-date" required>
                    </div>
                    <div class="input-group">
                        <label id="padded-label">End date:</label>
                        <input name="project-end-date" type="date" id="project-start-date">
                    </div>
                </div>
                <div class="input-group" id="project-description-input">
                    <label>Description</label>
                    <textarea name="project-description" id="project-description" placeholder="Enter project description"></textarea>
                </div>
                <div class="input-group">
                    <label>Countries</label>
                    <select name="countries" id="countries" placeholder="Select countries" multiple>
                        <option value="">Select countries</option>
                        {% for country in countries %}
                        <option value="{{country.pk}}">{{country.name}}</option>
                        {% endfor %}
                    </select>
                </div>
                <div class="input-group">
                    <label>User groups</label>
                    <select name="user-groups" id="user-groups" placeholder="User groups" multiple>
                        <option value="">User groups</option>
                        {% for group in usergroups %}
                        <option value="{{group.pk}}">{{group.name}}</option>
                        {% endfor %}
                    </select>
                </div>
                <div class="input-group">
                    <label>Other Members</label>
                    <select name="members" id="members" placeholder="Members" multiple>
                        <option value="">Members</option>
                        {% for u in users %}
                        {% if u.first_name != "" %}
                        <option value="{{u.pk}}">{{u.get_full_name}}</option>
                        {% endif %}
                        {% endfor %}
                    </select>
                </div>
                <div class="input-group">
                    <label>Admins</label>
                    <select name="admins" id="admins" placeholder="Admins" multiple>
                        <option value="">Admins</option>
                        {% for u in users %}
                        {% if u.first_name != "" %}
                        <option value="{{u.pk}}">{{u.get_full_name}}</option>
                        {% endif %}
                        {% endfor %}
                    </select>
                </div>
            </div>
        </form>
    </div>
</main>

{% endblock %}
