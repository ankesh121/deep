{% extends 'base.html' %}
{% load staticfiles %}

{% block title %}
DEEP | Leads
{% endblock %}

{% block head %}
<link rel="stylesheet" type="text/css" href="{% static 'css/datatables.min.css' %}"/>
<link rel="stylesheet" type="text/css" href="{% static 'css/dataTables.bootstrap.min.css' %}"/>
<link rel="stylesheet" type="text/css" href="{% static 'css/selectize.css' %}"/>
<link href="{% static 'css/leads.css' %}" type="text/css" rel="stylesheet">

<script>
    var currentEvent = {{event.pk}};
    var postUrl = "{% url 'leads:add' event.pk %}";
</script>

<script type="text/javascript" src="{% static 'js/common/datatables.min.js' %}"></script>
<script type="text/javascript" src="{% static 'js/common/selectize.js' %}"></script>
<script type="text/javascript" src="{% static 'js/common/utils.js' %}"></script>
<script type="text/javascript" src="{% static 'js/leads/leads.js' %}"></script>
{% endblock %}

{% block body %}

<div id="date-range-input" class="modal fade" role="dialog">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-body">
                <h3 class="modal-title">Enter date range</h3>
                <br>
                <div class="row">
                    <div class="col-sm-6">
                        <label>start date:</label><br>
                        <input type="date" id="start-date" class="form-control">
                    </div>
                    <div class="col-sm-6">
                        <label>end date:</label><br>
                        <input type="date" id="end-date" class="form-control">
                    </div>
                </div>
                <div style="margin-top: 24px; text-align: right;">
                    <button type="button" class="btn btn-default" id="cancel-btn" data-dismiss="modal">Cancel</button>
                    <button type="button" class="btn btn-primary" id="ok-btn" style="min-width: 50px; margin-left: 16px;" >Ok</button>
                </div>
            </div>
        </div>
    </div>
</div>

{% include 'navbar.html' %}

<main>
    <div class="container-fluid">
        <a class="btn btn-primary" id="add-lead-btn" href="{% url 'leads:add' event=event.pk %}" ><i class="fa fa-plus-square" style=" margin-right: 10px; font-size:1.2em"></i>Add Lead</a>
        <h1>Leads</h1>

        <div id="filters">
            <div class="row">
                <div class="col-md-1 first-child">
                    <label>Apply filter:</label>
                </div>
                <div class="col-md-2 low-padding">
                    <select id="assigned-to-filter" placeholder="Assigned to">
                        <option value="">Assigned to</option>
                    </select>
                </div>
                <div class="col-md-2 low-padding">
                    <select id="date-created-filter" placeholder="Date Created">
                        <option value="">Date Created</option>
                        <option value="today">Today</option>
                        <option value="yesterday">Yesterday</option>
                        <option value="last-seven-days">Last 7 days</option>
                        <option value="this-week">This week</option>
                        <option value="last-thirty-days">Last 30 days</option>
                        <option value="this-month">This month</option>
                        <option value="range">Range</option>
                    </select>
                </div>
                <div class="col-md-2 low-padding">
                    <select id="date-published-filter" placeholder="Date Published">
                        <option value="">Date Published</option>
                        <option value="today">Today</option>
                        <option value="yesterday">Yesterday</option>
                        <option value="last-seven-days">Last 7 days</option>
                        <option value="this-week">This week</option>
                        <option value="last-thirty-days">Last 30 days</option>
                        <option value="this-month">This month</option>
                        <option value="range">Range</option>
                    </select>
                </div>
                <div class="col-md-2 low-padding">
                    <select id="confidentiality-filter" placeholder="Confidentiality">
                        <option value="">Confidentiality</option>
                        <option value="Unprotected">Unprotected</option>
                        <option value="Protected">Protected</option>
                        <option value="Restricted">Restricted</option>
                        <option value="Confidential">Confidential</option>
                    </select>
                </div>
                <div class="col-md-2 last-child">
                    <select id="status-filter" placeholder="Status">
                        <option value="">Status</option>
                        <option value="Pending">Pending</option>
                        <option value="Processed">Processed</option>
                    </select>
                </div>
            </div>
        </div>
        <div id="leads-table-wrapper">
            <table id="leads-table" class="table" cellspacing="0" width="100%">
                <thead>
                    <tr>
                        <th>Created in</th>
                        <th>Created by</th>
                        <th>Assigned</th>
                        <th>Name</th>
                        <th>Published</th>
                        <th>Confidentiality</th>
                        <th>Source</th>
                        <th>Status</th>
                        <th>Actions</th>
                    </tr>
                </thead>
            </table>
        </div>
    </div>
</main>

<div id="drag-overlay" hidden>
    <div id="border">
        Drop the file here to add a lead from attachment
    </div>
</div>

<div id="add-lead-from-attachment" class="modal fade" role="dialog">
    <div class="modal-dialog">
        <div class="modal-content">
            <h3>Add Lead</h3>
            <form id="add-lead-form">
                {% csrf_token %}
                <div class="row">
                    <div class="col-sm-3 input-label"><label>Name</label></div>
                    <div class="col-sm-9"><input type="text" name="name" class="form-control" placeholder="Enter a descriptive name" required></div>
                </div>
                <div class="row">
                    <div class="col-sm-3 input-label"><label>Source</label></div>
                    <div class="col-sm-9">
                        <input class="form-control" id="source" name="source" placeholder="Select source type">
                    </div>
                </div>
                <div class="row">
                    <div class="col-sm-3 input-label"><label>Confidentiality</label></div>
                    <div class="col-sm-9">
                        <select id="confidentiality" name="confidentiality">
                            {% for c in confidentialities %}
                            <option value="{{c.0}}">{{c.1}}</option>
                            {% endfor %}
                        </select>
                    </div>
                </div>
                <div class="row">
                    <div class="col-sm-3 input-label"><label>Assign to</label></div>
                    <div class="col-md-9">
                        <select id="assigned-to" name="assigned-to" placeholder="Select user">
                            <option value="">Select user</option>
                            {% for u in users %}
                            <option value="{{u.pk}}">{{u.first_name}} {{u.last_name}}</option>
                            {% endfor %}
                        </select>
                    </div>
                </div>
                <div class="row">
                    <div class="col-sm-3 input-label"><label>Published at</label></div>
                    <div class="col-sm-9"> <div style="position:relative;"><input type="date" name="publish-date" class="form-control" placeholder="yyyy-mm-dd"></div></div>
                </div>
                <div class="row attachment-row">
                    <div class="col-sm-3 input-label"><label>Attachments</label></div>
                    <div class="col-sm-9" id="attachments-list"></div>
                </div>
                <div class="row manual-row">
                    <div class="col-sm-3 input-label"><label>Description</label></div>
                    <textarea class="col-sm-9" id="manual-text"></textarea>
                </div>
                <div class="row" id="action-row">
                    <div class="col-md-12">
                        <button type="button" class="btn btn-default" data-dismiss="modal">Cancel</button>
                        <input type="submit" class="btn btn-primary">
                    </div>
                </div>
            </form>

        </div>
    </div>
</div>

<form id="process-form" method="post" action="{% url 'leads:mark_processed' event=event.pk %}" hidden>
    {% csrf_token %}
    <input id="process-id" name="id" type="text">
    <input id="process-status" name="status" type="text">
</form>
<form id="delete-form" method="post" action="{% url 'leads:delete' event=event.pk %}" hidden>
    {% csrf_token %}
    <input id="delete-id" name="id" type="text">
</form>

{% endblock %}
