{% extends 'base.html' %}
{% load staticfiles %}

{% block head %}
<link href="{% static 'css/report-dash.css' %}" type="text/css" rel="stylesheet">
<link href="{% static 'css/selectize.css' %}" type="text/css" rel="stylesheet">
<link href="{% static 'css/selectize.bootstrap3.css' %}" type="text/css" rel="stylesheet">
<script src="{% static 'js/common/selectize.js' %}"></script>
<script src="{% static 'js/common/jquery.sparkline.min.js' %}"></script>
<script src="{% static 'js/report/report-dash.js' %}"></script>

<script>
var reports = [
    {% for report in weekly_reports_all %}
    {'country': '{{ report.country.pk }}', 'startDate': '{{ report.start_date }}', 'data': JSON.parse("{{ report.data|escapejs }}")},
    {% endfor %}
];
var affectedFieldIds = [
    {% for afid in affected_field_id_list %}
    {{ afid.pk }},
    {% endfor %}
];
var inNeedFieldIds = [
    {% for infid in in_need_field_id_list %}
    {{ infid.pk }},
    {% endfor %}
];
var accessConstraintsFieldIds = [
    {% for acfid in access_constraints_id_list %}
    {{ acfid.pk }},
    {% endfor %}
];
var humanAvailabilityFieldIds = [
    {% for hafid in human_availability_field_id_list %}
    {{ hafid.pk }},
    {% endfor %}
];
</script>
{% endblock %}

{% block body %}
{% include 'navbar.html' %}
<main>
    <div class="container-fluid">
        <h1>Report Dashboard</h1>
        <div class="row">
            <div class="col-md-8" style="padding-right: 0">
                <div id="country-list">
                    <div id="header">
                        <input id="country-search" placeholder="Search country">
                        <i class="fa fa-search"></i>
                        <div id="crisis-status">
                            <label class="active"><input name="crisis-status" value="2" type="radio" checked>All countries</label>
                            <label><input name="crisis-status" value="0" type="radio">Globally Monitored</label>
                            <label><input name="crisis-status" value="1" type="radio">Countries with active Crisis</label>
                        </div>
                    </div>
                    <div id="countries-header">
                        <div class="row">
                            <div class="col-md-3 first-child">
                                <div class="row">
                                    <div class="col-md-5 first-child">
                                        <label class="list-col" style="padding-left: 8px">Assigned to</label>
                                    </div>
                                    <div class="col-md-7 last-child">
                                        <label data-sorted="false" data-sort=".name" class="list-col">Name / Events</label>
                                    </div>
                                </div>
                            </div>
                            <div class="col-md-6 low-padding">
                                <div class="row">
                                    <div class="col-md-3 first-child">
                                        <label data-sort=".affected .number" class="list-col">Affected</label>
                                    </div>
                                    <div class="col-md-3 low-padding">
                                        <label data-sort=".in-need .number" class="list-col">In need</label>
                                    </div>
                                    <div class="col-md-3 low-padding">
                                        <label data-sort=".access-constraints .number" class="list-col">Access contraints</label>
                                    </div>
                                    <div class="col-md-3 last-child">
                                        <label data-sort=".geo-ranking .number"  class="list-col">Geo ranking</label>
                                    </div>
                                </div>
                            </div>
                            <div class="col-md-3 last-child">
                                <div class="row">
                                    <div class="col-md-4 first-child">
                                        <label data-sort=".availability .percent" class="list-col">Availability</label>
                                    </div>
                                    <div class="col-md-4 low-padding">
                                        <label data-sort=".recency .percent" class="list-col">Recency</label>
                                    </div>
                                    <div class="col-md-4 last-child">
                                        <label class="list-col">Change</label>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div id="countries">
                        {% for c in countries %}
                        <div class="country {% if country and country == c %}active{% endif %}" data-href="{% url 'report:dashboard' %}?country={{c.pk}}" data-name="{{c.name}}" data-crisis-status="{{c.event_set.all.0.status}}" data-pk="{{c.pk}}">
                            <div class="row">
                                <div class="col-md-3 first-child">
                                    <div class="row">
                                        <div class="col-md-5 first-child">
                                            <div class="assigned-to list-col">{% for e in c.event_set.all %}{% for u in e.assignee.all %}<span><i class="fa fa-user"></i>{{u.first_name}} {{u.last_name}}</span>{% endfor %}{% endfor %}
                                            </div>
                                        </div>
                                        <div class="col-md-7 last-child">
                                            <div class="list-col">
                                                <div class="name">{{c.name}}</div>
                                                <div class="events">{% for e in c.event_set.all %}{{ e }}{% if not forloop.last %}, {% endif %}{% endfor %}</div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                <div class="col-md-6 low-padding">
                                    <div class="row">
                                        <div class="col-md-3 first-child">
                                            <div class="affected list-col">
                                                <i class="fa"></i><span class="number">N/A</span>
                                                <div class="viz"></div>
                                            </div>
                                        </div>
                                        <div class="col-md-3 low-padding">
                                            <div class="in-need list-col">
                                                <i class="fa"></i><span class="number">N/A</span>
                                                <div class="viz"></div>
                                            </div>
                                        </div>
                                        <div class="col-md-3 low-padding">
                                            <div class="access-constraints list-col">
                                                <i class="fa"></i><span class="number">N/A</span>
                                                <div class="viz"></div>
                                            </div>
                                        </div>
                                        <div class="col-md-3 last-child">
                                            <div class="geo-ranking list-col">
                                                <i class="fa"></i><span class="number">N/A</span>
                                                <div class="viz"></div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                <div class="col-md-3 last-child">
                                    <div class="row">
                                        <div class="col-md-4 first-child">
                                            <div class="availability list-col">
                                                <i class="fa"></i><span class="percent"></span>
                                                <div class="viz"></div>
                                            </div>
                                        </div>
                                        <div class="col-md-4 low-padding">
                                            <div class="recency list-col">
                                                <i class="fa"></i><span class="percent"></span>
                                                <div class="viz"></div>
                                            </div>
                                        </div>
                                        <div class="col-md-4 last-child">
                                            <div class="change list-col">
                                                <i class="fa"></i><span class="percent"></span>
                                                <div class="viz">
                                                    <svg height="48" width="48">
                                                        <path stroke-width="3" fill="none" />
                                                    </svg>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        {% endfor %}
                    </div>
                </div>
            </div>
            <div class="col-md-4">
                <div id="country-detail">
                    {% if country %}
                    <div id="country-detail-header">
                        <div class="row">
                            <div class="col-md-5">
                                <h2>{{country.name}}</h2>
                            </div>
                            <div class="col-md-7">
                                <select id="select-event" data-country-pk="{{country.pk}}">
                                    {% for e in country.event_set.all %}
                                    <option value="{{e.pk}}" {% if event == e %}selected{% endif %}>{{e}}</option>
                                    {% endfor %}
                                </select>
                            </div>
                        </div>
                    </div>
                    <div id="weekly-report-list">
                        <div id="header">
                            {% if new_week_date %}
                            <button id="add-weekly-report-btn" class="btn btn-sm btn-primary" onclick="location.href='{% url 'report:weekly' country.pk event.pk %}?start_date={{new_week_date|date:"d-M-Y"}}';"><i class="fa fa-plus"></i>Add new report</button>
                            {% endif %}
                            <h3>Weekly reports</h3>
                        </div>
                        {% for report in weekly_reports %}
                        {% if new_week_date %}
                        {% endif %}
                        <div class="weekly-report">
                            <h4>Week #<span class="number">{{report.start_date|date:"W"}}</span></h4>
                            <p><date>{{report.start_date|date:"d-m-Y"}}</date> to <date>{{report.end_date|date:"d-m-Y"}}</date></p>
                            <div class="actions">
                                <a id="delete-button" onclick="if(confirm('Are you sure you want to delete the report?')) location.href='{% url 'report:delete_weekly' country.pk event.pk report.pk %}';"><i class="fa fa-trash"></i>Delete</a>
                                <a onclick="location.href='{% url 'report:weekly' country.pk event.pk report.pk %}';"><i class="fa fa-edit"></i>Edit</a>
                            </div>
                        </div>
                        {% empty %}
                        <p class="empty-text">No reports found</p>
                        {% endfor %}
                    </div>
                    {% endif %}
                </div>
            </div>
        </div>
    </div>
</main>
{% endblock %}
