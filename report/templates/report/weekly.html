{% extends 'base.html' %}
{% load staticfiles %}
{% load dict_access %}

{% block title %}
DEEP | Weekly Report
{% endblock %}

{% block head %}
<link href="{% static 'css/report-weekly.css' %}" type="text/css" rel="stylesheet">
<link href="{% static 'css/selectize.css' %}" type="text/css" rel="stylesheet">
<link href="{% static 'css/selectize.bootstrap3.css' %}" type="text/css" rel="stylesheet">
<script src="{% static 'js/report-weekly.js' %}"></script>
<script src="{% static 'js/selectize.js' %}"></script>
<script src="{% static 'js/utils.js' %}"></script>

<script>
    {% if report %}
    var data = JSON.parse("{{report.data|escapejs}}");
    {% else %}
    var data = {};
    {% endif %}

    if (!data["disaster_type"])
        data["disaster_type"] = null;
    if (!data["status"])
        data["status"] = null;

    if (!data["events"] || data["events"].length==0)
        data["events"] = [{"value":null, "start_date":null, "end_date":null, "category":null}];

    if (!data["human"])
        data["human"] = { "number": {}, "source": {}, "comment": {} };

    if (!data["people"])
        data["people"] = {
            "total": {}, "moderate": {}, "severe": {}, "planned": {},
            "total-source": {}, "moderate-source": {}, "severe-source": {}, "planned-source": {},
            "total-comment": {}, "moderate-comment": {}, "severe-comment": {}, "planned-comment": {},
        };
    if (!data["ipc"])
        data["ipc"] = {"a":null, "b":null, "c":null, "d":null, "e":null, "f":null, "g":null};
    if (!data["access"])
        data["access"] = {};
    if (!data["access-pin"])
        data["access-pin"] = { "number": {}, "source": {}, "comment": {} };

    var csrf_token = "{% csrf_token %}";

    {% if start_date %}
    var start_date = "{{start_date|date:'d-M-Y'}}";
    {% else %}
    var start_date = "{{report.date|date:'d-M-Y'}}";
    {% endif %}

</script>
{% endblock %}

{% block body %}
{% include 'navbar.html' %}
<section id="main">
    <div class="container-fluid">
        <header>
            <div class="row">
                <div class="col-md-8">
                    <h2>
                        Weekly Report / <small>{{event}}</small>
                    </h2>
                </div>
                <div class="col-md-4">
                    <button class="btn btn-primary btn-save btn-default" onmouseover="$(this).tooltip('show')" data-toggle="tooltip" data-placement="bottom" title="Save Report" id="save-btn"><i class="fa fa-save"></i> Save</button>
                    <button class="btn btn-danger btn-cancel btn-default" id="cancel-btn"><i class="fa fa-times"></i> Cancel</button>

                </div>
            </div>
            <div id="filters">
                <div class="row">
                    <div class="col-md-1">
                        <label>Apply filters:</label>
                    </div>
                    <div class="col-md-2">
                        <select class="filter">
                            <option>Option #1</option>
                        </select>
                    </div>
                    <div class="col-md-2">
                        <select class="filter">
                            <option>Option #1</option>
                        </select>
                    </div>
                    <div class="col-md-2">
                        <select class="filter">
                            <option>Option #1</option>
                        </select>
                    </div>
                    <div class="col-md-2">
                        <select class="filter">
                            <option>Option #1</option>
                        </select>
                    </div>
                    <div class="col-md-2">
                        <select class="filter">
                            <option>Option #1</option>
                        </select>
                    </div>
                </div>
            </div>
        </header>
        <div class="row">
            <div class="col-md-4">
                <div id="entries">
                    <h3>Entries</h3>
                    <hr>
                    {% for entry in entries %}
                    <div class="entry">
                        <h4>{{entry.lead.name}}</h4>
                        <div id="excerpts">
                            <!-- <label class="title">Excerpts:</label><br> -->
                            {% for data in entry.entryinformation_set.all %}
                            <!-- <label>{{data.attribute.name}}</label> -->
                            <div class="row">
                                <div class="col-md-6">
                                    <p>{{data.excerpt}}</p>
                                </div>
                                <div class="col-md-6">
                                    <div class="affected-groups">
                                        <label>Affected groups:</label><br>
                                        {% for ag in data.affected_groups.all %}
                                        {{ ag }}
                                        {% if not forloop.last %}, {% endif %}
                                        {% empty %}
                                        [N/A]
                                        {% endfor %}
                                    </div>
                                    <div class="specific-need-groups">
                                        <label>Specific needs groups:</label><br>
                                        {% for sng in data.specific_needs_groups.all %}
                                        {{ sng }}
                                        {% if not forloop.last %}, {% endif %}
                                        {% empty %}
                                        [N/A]
                                        {% endfor %}
                                    </div>
                                    <div class="vulnerable-groups">
                                        <label>Vulnerable groups:</label><br>
                                        {% for vg in data.vulnerable_groups.all %}
                                        {{ vg }}
                                        {% if not forloop.last %}, {% endif %}
                                        {% empty %}
                                        [N/A]
                                        {% endfor %}
                                    </div>
                                </div>
                            </div>
                            <div class="row">
                                <div class="col-md-6">
                                    <div class="reliability">
                                        <label>Reliablility:</label><!--span class="reliability"> {{data.reliability}}</span>, <label>Severity:</label><span class="severity"> {{data.severity}}</span-->
                                        {% for reliability in reliabilities %}
                                        <span data-id="{{reliability.pk}}" class="_{{reliability.level}}  {% if data.reliability == reliability %}active{% endif %}" onmouseover="$(this).tooltip('show')" data-toggle="tooltip" data-placement="bottom" title="{{reliability}}"></span>
                                        {% endfor %}
                                    </div>
                                </div>
                                <div class="col-md-6">
                                    <div class="severity">
                                        <label>Severity:</label><!--span class="reliability"> {{data.reliability}}</span>, <label>Severity:</label><span class="severity"> {{data.severity}}</span-->
                                        {% for severity in severities %}
                                        <span data-id="{{severity.pk}}" class="_{{severity.level}}  {% if data.severity == severity %}active{% endif %}" onmouseover="$(this).tooltip('show')" data-toggle="tooltip" data-placement="bottom" title="{{severity}}"></span>
                                        {% endfor %}
                                    </div>
                                </div>
                            </div>
                            <hr>
                            {% empty %}
                            <p>[N/A]</p>
                            {% endfor %}
                        </div>
                    </div>
                    {% if not forloop.last %}<hr>{% endif %}
                    {% endfor %}

                </div>
            </div>
            <div class="col-md-8">
                <div id="report-content">
                    <div id="navigator">
                        <a href="#key-events">Key events</a>
                        <a href="#humanitarian-profile">Humanitarian profile</a>
                        <a href="#people-in-need">People in need</a>
                        <a href="#humanitarian-access">Humanitarian access</a>
                        <hr>
                    </div>
                    <section id="key-events">
                        <h3>Key Events</h3>
                        <div class="row">
                            <div class="col-md-6">
                                <label>Select type of disaster:</label>
                                <select id="disaster-type-select" placeholder="Select type of disaster">
                                    <option>--Select type of disaster--</option>
                                {% for type in disaster_types %}
                                    <option value="{{type.pk}}">{% if type.parent %}{{type.parent}} / {% endif %}{{type}}</option>
                                {% endfor %}
                                </select>
                            </div>
                            <div class="col-md-6">
                                <label>Select status:</label>
                                <select id="status-select" placeholder="Select status">
                                    <option>--Select status--</option>
                                {% for status in report_statuses %}
                                    <option value="{{status.pk}}">{{status}}</option>
                                {% endfor %}
                                </select>
                            </div>
                        </div>
                        <br>
                        <div class="row">
                            <div class="col-md-12">
                                <h4>Events for timeline:</h4>
                                <div id="event-timeline-container">
                                </div>
                            </div>
                        </div>
                        <div class="event-timeline-template" hidden>
                            <div class="row">
                                <div class="col-md-9">
                                    <input class="form-control event-value">
                                </div>
                                <div class="col-md-3">
                                    <button class="btn btn-default" >Add</button>
                                </div>
                            </div>
                            <div class="row">
                                <div class="col-md-3">
                                    <label>start date:</label>
                                    <input type="date" class="form-control start-date">
                                </div>
                                <div class="col-md-3">
                                    <label>end date:</label>
                                    <input type="date" class="form-control end-date">
                                </div>
                                <div class="col-md-3">
                                    <label></label>
                                    <select class="category-select" placeholder="Select Category">
                                        <option>--Select category--</option>
                                    {% for category in category_timelines %}
                                        <option value="{{category.pk}}">{{category}}</option>
                                    {% endfor %}
                                    </select>
                                </div>
                            </div>
                            <br>
                        </div>
                    </section>
                    <section id="humanitarian-profile">
                        <h3>Humanitarian Profile</h3>
                        {% for field in human_profile_fields %}

                        <div class="row">
                            <div class="col-md-6"><label>{{field.name}}</label></div>
                            <div class="col-md-2"><input class="human-number form-control" data-human-pk="{{field.pk}}" placeholder="Number of person"></div>
                            <div class="col-md-2"><input class="human-source form-control" data-human-pk="{{field.pk}}" placeholder="Source/Date"></div>
                            <div class="col-md-2"><input class="human-comment form-control" data-human-pk="{{field.pk}}" placeholder="Comment"></div>
                        </div>

                        {% for subfield in field.humanprofilefield_set.all %}

                        <div class="row">
                            <div class="col-md-6"><label  class="sub">{{subfield.name}}</label></div>
                            <div class="col-md-2"><input class="human-number form-control" data-human-pk="{{subfield.pk}}" placeholder="Number of person"></div>
                            <div class="col-md-2"><input class="human-source form-control" data-human-pk="{{subfield.pk}}" placeholder="Source/Date"></div>
                            <div class="col-md-2"><input class="human-comment form-control" data-human-pk="{{subfield.pk}}" placeholder="Comment"></div>
                        </div>

                        {% endfor %}
                        {% endfor %}
                    </section>
                    <section id="people-in-need">
                        <h3>People in need</h3>
                        {% for field in people_in_need_fields %}
                        <div class="row toplevel">
                            <div class="col-md-4">
                                <div class="row">
                                    <div class="col-md-12">
                                        <label>{{field.name}}</label>
                                    </div>
                                </div>
                            </div>
                            <div class="col-md-8">
                                <div class="row">
                                    <div class="col-md-3"><input class="people-total form-control" data-people-pk="{{field.pk}}" placeholder="Total"></div>
                                    <div class="col-md-3"><input class="people-moderate form-control" data-people-pk="{{field.pk}}" placeholder="Moderate"></div>
                                    <div class="col-md-3"><input class="people-severe form-control" data-people-pk="{{field.pk}}" placeholder="Severe"></div>
                                    <div class="col-md-3"><input class="people-planned form-control" data-people-pk="{{field.pk}}" placeholder="Planned"></div>
                                </div>
                                <div class="row">
                                    <div class="col-md-3"><input class="people-total-source form-control" data-people-pk="{{field.pk}}" placeholder="Source/Date"></div>
                                    <div class="col-md-3"><input class="people-moderate-source form-control" data-people-pk="{{field.pk}}" placeholder="Source/Date"></div>
                                    <div class="col-md-3"><input class="people-severe-source form-control" data-people-pk="{{field.pk}}" placeholder="Source/Date"></div>
                                    <div class="col-md-3"><input class="people-planned-source form-control" data-people-pk="{{field.pk}}" placeholder="Source/Date"></div>
                                </div>
                                <div class="row">
                                    <div class="col-md-3"><input class="people-total-comment form-control" data-people-pk="{{field.pk}}" placeholder="Comment"></div>
                                    <div class="col-md-3"><input class="people-moderate-comment form-control" data-people-pk="{{field.pk}}" placeholder="Comment"></div>
                                    <div class="col-md-3"><input class="people-severe-comment form-control" data-people-pk="{{field.pk}}" placeholder="Comment"></div>
                                    <div class="col-md-3"><input class="people-planned-comment form-control" data-people-pk="{{field.pk}}" placeholder="Comment"></div>
                                </div>
                            </div>
                        </div>
                        {% for subfield in field.peopleinneedfield_set.all %}
                        <div class="row toplevel">
                            <div class="col-md-4">
                                <div class="row">
                                    <div class="col-md-12">
                                        <label class="sub">{{subfield.name}}</label>
                                    </div>
                                </div>
                            </div>
                            <div class="col-md-8">
                                <div class="row">
                                    <div class="col-md-3"><input class="people-total form-control" data-people-pk="{{subfield.pk}}" placeholder="Total"></div>
                                    <div class="col-md-3"><input class="people-moderate form-control" data-people-pk="{{subfield.pk}}" placeholder="Moderate"></div>
                                    <div class="col-md-3"><input class="people-severe form-control" data-people-pk="{{subfield.pk}}" placeholder="Severe"></div>
                                    <div class="col-md-3"><input class="people-planned form-control" data-people-pk="{{subfield.pk}}" placeholder="Planned"></div>
                                </div>
                                <div class="row">
                                    <div class="col-md-3"><input class="people-total-source form-control" data-people-pk="{{subfield.pk}}" placeholder="Source/Date"></div>
                                    <div class="col-md-3"><input class="people-moderate-source form-control" data-people-pk="{{subfield.pk}}" placeholder="Source/Date"></div>
                                    <div class="col-md-3"><input class="people-severe-source form-control" data-people-pk="{{subfield.pk}}" placeholder="Source/Date"></div>
                                    <div class="col-md-3"><input class="people-planned-source form-control" data-people-pk="{{subfield.pk}}" placeholder="Source/Date"></div>
                                </div>
                                <div class="row">
                                    <div class="col-md-3"><input class="people-total-comment form-control" data-people-pk="{{subfield.pk}}" placeholder="Comment"></div>
                                    <div class="col-md-3"><input class="people-moderate-comment form-control" data-people-pk="{{subfield.pk}}" placeholder="Comment"></div>
                                    <div class="col-md-3"><input class="people-severe-comment form-control" data-people-pk="{{subfield.pk}}" placeholder="Comment"></div>
                                    <div class="col-md-3"><input class="people-planned-comment form-control" data-people-pk="{{subfield.pk}}" placeholder="Comment"></div>
                                </div>
                            </div>
                        </div>
                        {% endfor %}
                        {% endfor %}
                        <div class="row toplevel">
                            <div class="col-md-4">
                                <div class="row">
                                    <div class="col-md-12">
                                        <label class="sub">IPC</label>
                                    </div>
                                </div>
                            </div>
                            <div class="col-md-8">
                                <div class="row">
                                    <div class="col-md-3"><label class="sub">1. None/Minimal</label></div>
                                    <div class="col-md-3"><input data-ipc="a" class="form-control" placeholder="Number"></div>
                                    <div class="col-md-3"><label class="sub">4. Emergency</label></div>
                                    <div class="col-md-3"><input data-ipc="b" class="form-control" placeholder="Number"></div>
                                </div>
                                <div class="row">
                                    <div class="col-md-3"><label class="sub">2. Stressed</label></div>
                                    <div class="col-md-3"><input data-ipc="c" class="form-control" placeholder="Number"></div>
                                    <div class="col-md-3"><label class="sub">5. Famine</label></div>
                                    <div class="col-md-3"><input data-ipc="d" class="form-control" placeholder="Number"></div>
                                </div>
                                <div class="row">
                                    <div class="col-md-3"><label class="sub">3. Crisis</label></div>
                                    <div class="col-md-3"><input data-ipc="e" class="form-control" placeholder="Number"></div>
                                    <div class="col-md-6"><input data-ipc="f" class="form-control" placeholder="Source"></div>
                                </div>
                                <div class="row">
                                    <div class="col-md-12"><input data-ipc="g" class="form-control" placeholder="Comment"></div>
                                </div>
                            </div>
                        </div>
                    </section>
                    <section id="humanitarian-access">
                        <h3>Humanitarian access</h3>
                        <div class="row">
                            <div class="col-md-7">
                                {% for field in human_access_fields %}
                                <div class="row">
                                    <div class="col-md-8"><label class="title">{{field.name}}</label></div>
                                    <div class="col-md-4">
                                        <select class="access-select" data-access-pk="{{field.pk}}">
                                            <option value="Yes">Yes</option>
                                            <option value="No">No</option>
                                            <option value="DNK">DNK</option>
                                        </select>
                                    </div>
                                </div>
                                {% endfor %}
                            </div>
                            <div class="col-md-5 right-pane">
                                {% for field in human_access_pin_fields %}
                                <div>
                                    <div class="row">
                                        <div class="col-md-12">
                                            <label class="title">{{field.name}}</label>
                                        </div>
                                    </div>
                                    <div class="row">
                                        <div class="col-md-5"><input class="form-control access-pin-number" data-access-pin-pk="{{field.pk}}" placeholder="Number"></div>
                                        <div class="col-md-7"><input class="form-control access-pin-source" data-access-pin-pk="{{field.pk}}" placeholder="Source/Date"></div>
                                    </div>
                                    <div class="row">
                                        <div class="col-md-12"><input class="form-control access-pin-comment" data-access-pin-pk="{{field.pk}}" placeholder="Comment"></div>
                                    </div>
                                </div>
                                {% endfor %}
                            </div>
                        </div>
                    </section>
                </div>
            </div>
        </div>
    </div>
</section>
{% endblock %}
