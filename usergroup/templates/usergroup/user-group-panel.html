{% extends 'base.html' %}
{% load watchful_url %}

{% block title %}
DEEP | User Group Panel
{% endblock %}

{% block head %}

<link rel="stylesheet" type="text/css" href="{% watchful_static_url 'css/selectize.css' %}"/>
<link href="{% watchful_static_url 'css/user-group-panel.css' %}" type="text/css" rel="stylesheet">
<script type="text/javascript" src="{% watchful_static_url 'js/common/utils.js' %}"></script>
<script type="text/javascript" src="{% watchful_static_url 'js/common/floating-button.js' %}"></script>
<script type="text/javascript" src="{% watchful_static_url 'js/usergroup/user-group-panel.js' %}"></script>

<script>
let crisis_panel_url = '{% url "custom_admin:crisis_panel" %}';
let userGroupPk = '{{ usergroup.pk }}';
let activities = [
    {% for activity in activities %}
    $.extend(
        {
            timestamp: new Date('{{ activity.timestamp.isoformat }}'),
            user: {
                pk: '{{activity.user.pk}}', name: '{{activity.user.get_full_name}}'
            },
            {% if activity.group %}
            group: {
                pk: '{{activity.group.pk}}', name: '{{activity.group.name}}'
            }
            {% endif %}
        },
        JSON.parse('{{activity.activity|escapejs}}')
    ),
    {% endfor %}
];

console.log(activities);
</script>

{% endblock %}

{% block body %}

<nav>
    <h1>User Group Management</h1>
    <a href="{% url 'login' %}"><i class="fa fa-long-arrow-left"></i>Back to DEEP</a>
</nav>

<main>
    <header>
        <h2>{{ usergroup.name }}</h2>
        <div id="navigator">
            <a data-target="#members-wrapper" class="nav-active">Members</a>
            <a data-target="#projects-wrapper">Projects</a>
            <a data-target="#templates-wrapper">Templates</a>
        </div>
    </header>

    <section>
        <div id="members-wrapper">
            <div id="members">
                {% for member in usergroup.members.all %}
                <div class="member" data-url="{% url 'user_profile' member.pk %}" data-pk="{{member.pk}}">
                    <div class="img-container">
                        <img src="{% watchful_static_url 'img/default-avatar.png' %}">
                    </div>
                    <div class="member-details">
                        <div class="name">{{member.get_full_name}}</div>
                        <div class="extra">{{member.username}}</div>
                    </div>
                    <div class="action-container">
                        <i class="fa fa-check"></i>
                    </div>
                </div>
                {% endfor %}
            </div>
        </div>
        <div id="projects-wrapper" hidden>
            <div id="projects-header">
                <label class="name" data-sort=".name">Name</label>
                <label class="type" data-sort=".type">Type</label>
                <label class="countries" data-sort=".countries">Countries</label>
                <label class="start-date" data-sort=".start-date date">Start Date</label>
            </div>
            <div id="projects">
                {% for crisis in usergroup.projects.all %}
                <div class="project" data-url="{% url 'custom_admin:crisis_panel' %}?selected={{crisis.pk}}">
                    <div class="name">{{crisis.name}}</div>
                    <div class="type">{{crisis.disaster_type.name}}</div>
                    <div class="countries">{% for country in crisis.countries.all %}{{country}}{% if not forloop.last %}, {% endif %}{% endfor %}</div>
                    <div class="start-date"><date hidden>{{crisis.start_date|date:"Y-m-d"}}</date>{{crisis.start_date}}</div>
                </div>
                {% endfor %}
            </div>
        </div>
        <div id="templates-wrapper" hidden>
            <div id="templates">
                Templates
            </div>
        </div>
        <div id="clear-selection-toast">
            <div><span></span>Selected</div>
            <div class="clear-btn">Clear selection</div>
        </div>
        <button class="floating-btn" id="add-members">+</button>
    </section>
</main>

<aside>
    <header>
        <h2>Activity log</h2>
    </header>
    <div id='activity-log'>
    </div>
    <div class='activity-template' hidden>
        <h3></h3>
        <date></date>
        <a></a>
    </div>
</aside>

{% endblock %}
